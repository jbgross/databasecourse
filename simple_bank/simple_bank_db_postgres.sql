-- PostgreSQL simple_bank

-- =========================
-- Tables
-- =========================
DROP TABLE IF EXISTS account_transaction;
DROP TABLE IF EXISTS transaction_type;
DROP TABLE IF EXISTS bank_account;
DROP TABLE IF EXISTS account_type;
DROP TABLE IF EXISTS account_holder;
CREATE TABLE IF NOT EXISTS account_holder
(
  holder_id   INTEGER PRIMARY KEY,
  holder_name VARCHAR(64) NOT NULL,
  birthdate   DATE NOT NULL
);

INSERT INTO account_holder (holder_id, holder_name, birthdate) VALUES 
(46311, 'Sally Hernandez', '1968-04-15'),
(46312, 'Robert Li', '1980-09-01'),
(46313, 'Hugh Wolf', '1975-12-05'),
(46314, 'Alex Smith', '1955-07-12'),
(46315, 'Phillip Gomez', '1985-08-14'),
(46316, 'Amelia Clarke', '1977-03-19'),
(46317, 'Lucy Sutton', '1978-11-11'),
(46318, 'Jin Hao', '1966-06-16'),
(46319, 'Fitzhugh Wallace', '1948-04-12');

CREATE TABLE account_type
(
  account_type CHAR(16) PRIMARY KEY
);

INSERT INTO account_type (account_type) VALUES ('Checking');
INSERT INTO account_type (account_type) VALUES ('Savings');

CREATE TABLE bank_account
(
  account_id     INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  holder_id      INTEGER NOT NULL,
  balance        NUMERIC(16,2) NOT NULL,
  account_type   CHAR(16) NOT NULL,
  interest_rate  NUMERIC(4,4) NULL,
  CONSTRAINT fk_bank_account_type
    FOREIGN KEY (account_type) REFERENCES account_type(account_type) ON DELETE CASCADE,
  CONSTRAINT fk_bank_account_holder
    FOREIGN KEY (holder_id) REFERENCES account_holder(holder_id) ON DELETE CASCADE
);

-- Since your inserts provide explicit account_id values, Postgres will accept them.
-- (The identity sequence may need to be advanced afterward; see setval below.)
INSERT INTO bank_account (account_id, holder_id, balance, account_type, interest_rate) VALUES
(451267, 46312, 150.00, 'Checking', NULL),
(631826, 46313, 9127.44, 'Checking', NULL),
(124127, 46314, 847.66, 'Checking', 0),
(938421, 46315, 766.00, 'Checking', 0),
(348944, 46316, 320.31, 'Checking', 0),
(678193, 46317, 7542.00, 'Savings', 0),
(538465, 46318, 427.66, 'Savings', 0.01),
(543654, 46319, 4237.36, 'Savings', 0.02),
(981236, 46312, 42212.12, 'Savings', 0.03),
(724968, 46313, 54.55, 'Savings', 0);

-- If you plan to insert future rows WITHOUT specifying account_id,
-- advance the identity sequence to at least the current max:
SELECT setval(pg_get_serial_sequence('bank_account','account_id'),
              (SELECT MAX(account_id) FROM bank_account));

CREATE TABLE transaction_type
(
  transaction_type VARCHAR(16) PRIMARY KEY
);

INSERT INTO transaction_type (transaction_type) VALUES ('Open');
INSERT INTO transaction_type (transaction_type) VALUES ('Close');
INSERT INTO transaction_type (transaction_type) VALUES ('Deposit');
INSERT INTO transaction_type (transaction_type) VALUES ('Withdrawal');
INSERT INTO transaction_type (transaction_type) VALUES ('Check');



CREATE TABLE account_transaction
(
account_id INT NOT NULL,
transaction_id INT,
transaction_type VARCHAR (16) NOT NULL,
transaction_time TIMESTAMP NOT NULL DEFAULT NOW(),
amount DECIMAL(16,2),
PRIMARY KEY (account_id, transaction_id),
FOREIGN KEY (account_id) REFERENCES bank_account(account_id),
FOREIGN KEY (transaction_type) REFERENCES transaction_type(transaction_type)
);

INSERT INTO account_transaction (account_id, transaction_id, transaction_type, amount, transaction_time) VALUES
(451267, 1001, 'Open', 50, '2024-01-01 00:12:34'),
(451267, 1002, 'Deposit', 75.32, '2024-02-03 14:47:56'),
(451267, 1004, 'Check', 27.15, '2024-04-02 16:35:44'),
(451267, 1005, 'Check', 30.15, '2024-05-19 11:08:29'),
(631826, 1001, 'Open', 9015.40, '2024-03-18 06:45:10'),
(631826, 1002, 'Check', 300.37, '2024-02-14 15:26:10'),
(631826, 1003, 'Check', 115.49, '2024-03-11 13:44:02'),
(631826, 1004, 'Check', 96.18, '2024-04-28 10:59:18'),
(631826, 1005, 'Deposit', 625.08, '2024-06-03 16:21:40'),
(124127, 1001, 'Open', 900, '2024-05-29 11:22:48'),
(124127, 1002, 'Deposit', 315.44, '2024-02-18 12:37:19'),
(124127, 1003, 'Check', 204.18, '2024-03-25 17:52:07'),
(124127, 1004, 'Deposit', 85, '2024-05-09 09:46:58'),
(124127, 1005, 'Open', 248.60, '2024-06-22 14:18:05'),
(938421, 1001, 'Open', 712.41, '2024-07-07 15:59:03'),
(938421, 1002, 'Check', 148.92, '2024-02-27 16:33:21'),
(938421, 1003, 'Check', 16.97, '2024-03-14 11:11:11'),
(938421, 1004, 'Check', 16.97, '2024-04-30 15:09:47'),
(938421, 1005, 'Deposit', 236.45, '2024-06-11 13:58:36'),
(348944, 1001, 'Open', 304.14, '2024-09-25 19:14:27'),
(348944, 1002, 'Check', 7.61, '2024-02-04 10:41:22'),
(348944, 1003, 'Deposit', 61.04, '2024-03-18 14:19:51'),
(348944, 1004, 'Withdrawal', 91.82, '2024-04-26 16:06:33'),
(348944, 1005, 'Deposit', 54.56, '2024-06-08 11:27:45'),
(678193, 1001, 'Open', 7615.55, '2024-12-11 23:40:55'),
(678193, 1002, 'Deposit', 616.43, '2025-02-15 14:15:19'),
(678193, 1003, 'Withdrawal', 780.00, '2025-03-10 10:44:08'),
(678193, 1004, 'Withdrawal', 699.95, '2025-04-21 16:32:57'),
(678193, 1005, 'Deposit', 789.97, '2025-06-02 13:20:40'),
(538465, 1001, 'Open', 1414.14, '2025-02-16 03:08:19'),
(538465, 1002, 'Withdrawal', 967.00, '2025-02-19 15:49:26'),
(538465, 1003, 'Deposit', 215.76, '2025-03-27 11:03:54'),
(538465, 1004, 'Withdrawal', 18.98, '2025-04-09 10:28:41'),
(538465, 1005, 'Withdrawal', 216.26, '2025-06-17 16:55:09'),
(543654, 1001, 'Open', 5147.31, '2025-04-30 08:36:42'),
(543654, 1002, 'Deposit', 180.66, '2025-02-06 12:16:38'),
(543654, 1003, 'Withdrawal', 894.22, '2025-03-22 17:05:27'),
(543654, 1004, 'Withdrawal', 65.18, '2025-04-30 14:49:52'),
(543654, 1005, 'Deposit', 41.06, '2025-06-25 09:31:16'),
(981236, 1001, 'Open', 42212.12, '2025-08-14 13:27:06'),
(981236, 1002, 'Deposit', 79.66, '2025-02-13 13:57:44'),
(981236, 1003, 'Deposit', 202.12, '2025-03-05 10:22:18'),
(981236, 1004, 'Withdrawal', 39.44, '2025-04-18 15:11:53'),
(981236, 1005, 'Withdrawal', 68.61, '2025-06-29 16:40:07'),
(724968, 1001, 'Open', 54.55, '2025-12-31 21:55:29'),
(724968, 1002, 'Deposit', 61.64, '2025-02-24 14:07:58'),
(724968, 1003, 'Withdrawal', 86.43, '2025-03-16 11:39:46'),
(724968, 1004, 'Deposit', 271.44, '2025-04-27 16:18:03'),
(724968, 1005, 'Deposit', 816.50, '2025-06-07 13:26:54');
